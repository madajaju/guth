#!/usr/bin/env node

const fs = require('fs');
const program = require('commander');
const path = require('path');
// Check for node_modules directory. If it exists then continue. If not ask to run npm install.
/* if(!fs.existsSync('./node_modules')) {
    console.error('Error: you must run "npm install" first');
    return;
}
 */

const server = require('ailtire');
let host = process.env.AITIRE_HOST || 'localhost'
let port = process.env.AITIRE_PORT || 80
let urlPrefix = process.env.AITIRE_BASEURL || '/web'

program.description("Upload podcast to the manager")
    .option('--dir <string>', "Directory with the podcast definition");

program.parse(process.argv);

let options = program.opts();

let config = {
    baseDir: `${__dirname}/../..`,
    prefix: 'guth',
    routes: {},
    host: host,
    urlPrefix: urlPrefix,
    listenPort: port,
    post: (config) => {
        console.log("Starting Podcast Load!");
        Podcast.load({directory:config.podcastDir});
        console.log("Done with Podcast Load!");
    }
};

if(options.dir) {
    config.podcastDir = path.resolve(options.dir);
}

process.chdir(`${__dirname}/../..`);
server.listen( config );

